# Test via Inspector Guide

MCP Inspector is a tool for testing and debugging MCP servers. This guide explains how to use it to test the BanyanDB MCP server.

## Prerequisites

- MCP server set up (see [Setup Guide](setup.md))
- BanyanDB running and accessible
- Node.js 20+ installed (for running Inspector)

## Installation

Install MCP Inspector globally:

```bash
npm install -g @modelcontextprotocol/inspector
```

Or use it directly with npx (no installation needed):

```bash
npx @modelcontextprotocol/inspector
```

## Basic Setup

### 1. Create Configuration File

```bash
cp example-config.json inspector-config.json
```

Edit `inspector-config.json` with absolute path, api key and base url.

**Important:** Use absolute paths for the binary location.

### 2. Start Inspector (UI Mode)

```bash
npx @modelcontextprotocol/inspector --config inspector-config.json
```

This will:
- Start the MCP server
- Open a web UI at `http://localhost:6274` in your default browser
- Allow you to interactively test MCP tools

### 3. Using the Inspector UI

1. **View Available Tools**: The UI shows all available MCP tools (e.g., `list_resources_bydbql`)
2. **Test Queries**: Enter natural language descriptions and see the generated BydbQL queries
3. **View Results**: See the query results returned from BanyanDB
4. **Debug**: Check logs and error messages in the Inspector console

## CLI Mode

You can also use Inspector in CLI mode for scripting and automation:

```bash
npx @modelcontextprotocol/inspector --cli node dist/index.js \
  -e BANYANDB_ADDRESS=localhost:17900 \
  -e LLM_API_KEY=sk-your-key-here \
  --method tools/call \
  --tool-name list_resources_bydbql \
  --tool-arg "description=Show MEASURE service_cpm_minute in sw_metricsMinute from last hour"
```

## Usage Examples

The MCP server translates natural language descriptions into BydbQL queries and executes them against BanyanDB. Here's how it works:

### Example 1: Top-N Query with Aggregation

**Natural Language Description:**
```
Show TOP3 MEASURE endpoint_2xx in metricsMinute from last 48 hours, AGGREGATE BY MAX and ORDER BY DESC
```

**Generated BydbQL Query:**
```sql
SHOW TOP 3 FROM MEASURE endpoint_2xx IN metricsMinute TIME >= '-48h' AGGREGATE BY MAX ORDER BY DESC
```

**Result:**
```json
{
  "dataPoints": [
    {
      "timestamp": "2024-01-14T14:30:00Z",
      "fields": {
        "endpoint": "/api/users",
        "value": 1250
      }
    },
    {
      "timestamp": "2024-01-14T15:15:00Z",
      "fields": {
        "endpoint": "/api/products",
        "value": 980
      }
    },
    {
      "timestamp": "2024-01-14T16:00:00Z",
      "fields": {
        "endpoint": "/api/orders",
        "value": 750
      }
    }
  ]
}
```

### Example 2: Querying a Stream

**Natural Language Description:**
```
Show STREAM log in recordsLog from last hour
```

**Generated BydbQL Query:**
```sql
SELECT * FROM STREAM log IN recordsLog TIME >= '-1h'
```

**Result:**
```json
{
  "dataPoints": [
    {
      "timestamp": "2024-01-15T10:30:00Z",
      "fields": {
        "level": "INFO",
        "message": "Request processed successfully",
        "service": "api-service"
      }
    },
    {
      "timestamp": "2024-01-15T10:31:00Z",
      "fields": {
        "level": "ERROR",
        "message": "Database connection failed",
        "service": "api-service"
      }
    }
  ]
}
```

### Example 3: Querying Traces

**Natural Language Description:**
```
List TRACE zipkin_span in zipkinTrace from last 48 hour, order by timestamp_millis desc
```

**Generated BydbQL Query:**
```sql
SELECT * FROM TRACE zipkin_span IN zipkinTrace TIME >= '-48h' ORDER BY timestamp_millis DESC
```

**Result:**
```json
{
  "dataPoints": [
    {
      "timestamp": "2024-01-15T10:45:00Z",
      "fields": {
        "trace_id": "abc123",
        "span_id": "def456",
        "duration": 125,
        "timestamp_millis": 1705315500000
      }
    },
    {
      "timestamp": "2024-01-15T10:44:00Z",
      "fields": {
        "trace_id": "xyz789",
        "span_id": "uvw012",
        "duration": 89,
        "timestamp_millis": 1705315440000
      }
    }
  ]
}
```

## Troubleshooting

**Inspector UI not opening:**
- Check if port 6274 is available
- Verify the MCP server binary path is correct
- Check Inspector logs for errors

**MCP server not starting:**
- Verify Node.js 20+ is installed: `node --version`
- Check environment variables are set correctly
- Verify BanyanDB is accessible: `curl http://localhost:17913/api/healthz`

**Query generation fails:**
- Check LLM_API_KEY is set if using LLM-powered generation
- Verify network connectivity to LLM API
- Check Inspector console for error messages

**No results returned:**
- Verify BanyanDB has data for the queried resources
- Check time range is appropriate
- Verify resource names and groups are correct

## Resources

- [MCP Inspector Documentation](https://github.com/modelcontextprotocol/inspector)
- [MCP Protocol Documentation](https://modelcontextprotocol.io/)
- [BanyanDB Documentation](../../../README.md)

